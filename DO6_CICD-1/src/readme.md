# Part 1. Настройка gitlab-runner  

### Скачать и установить на виртуальную машину gitlab-runner

* curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh | sudo bash

* sudo apt install gitlab-runner 

* ![](image.png)  

### Запустить gitlab-runner и зарегистрировать его для использования в текущем проекте (DO6_CICD)

* sudo gitlab-runner start  
![](image-1.png)  

* sudo gitlab-runner register  
![](image-2.png)  

# Part 2. Сборка

### Написать этап для CI по сборке приложений из проекта C2_SimpleBashUtils:

#### В файле gitlab-ci.yml добавить этап запуска сборки через мейк файл из проекта C2  

#### Файлы, полученные после сборки (артефакты), сохранять в произвольную директорию со сроком хранения 30 дней. 


![](image-3.png)   

![](image-4.png)  

![](image-7.png)





# Part 3. Тест кодстайла

### Написать этап для CI, который запускает скрипт кодстайла (clang-format):

#### Если кодстайл не прошел, то "зафейлить" пайплайн

#### В пайплайне отобразить вывод утилиты clang-format

![](image-5.png)  

![](image-8.png)


# Part 4. Интеграционные тесты  
### Написать этап для CI, который запускает ваши интеграционные тесты из того же проекта:

#### Запускать этот этап автоматически только при условии, если сборка и тест кодстайла прошли успешно

#### Если тесты не прошли, то "зафейлить" пайплайн

#### В пайплайне отобразить вывод, что интеграционные тесты успешно прошли / провалились  

![](image-6.png)  

![](image-9.png)

# Part 5. Этап деплоя

#### Поднять вторую виртуальную машину Ubuntu Server 20.04 LTS


* vm1  
![](image-10.png)
* vm2  
![](image-11.png)  

### Написать этап для CD, который "разворачивает" проект на другой виртуальной машине:  

* ![](image-12.png)  
![Alt text](image-13.png)  




#### Запускать этот этап вручную при условии, что все предыдущие этапы прошли успешно

#### Написать bash-скрипт, который при помощи ssh и scp копирует файлы, полученные после сборки (артефакты), в директорию /usr/local/bin второй виртуальной машины
#### Тут вам могут помочь знания, полученные в проекте DO2_LinuxNetwork  


#### Будьте готовы объяснить по скрипту, как происходит перенос.


#### В файле gitlab-ci.yml добавить этап запуска написанного скрипта

#### В случае ошибки "зафейлить" пайплайн


![](image-18.png)

# Part 6. Дополнительно. Уведомления

### Настроить уведомления о успешном/неуспешном выполнении пайплайна через бота с именем "[ваш nickname] DO6 CI/CD" в Telegram
#### Текст уведомления должен содержать информацию об успешности прохождения как этапа CI, так и этапа CD.
#### В остальном текст уведомления может быть произвольным.

![](image-15.png)  
![](image-16.png)   
![](image-17.png)

![](image-14.png)  

![](image-19.png)